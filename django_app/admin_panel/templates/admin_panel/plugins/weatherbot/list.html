{% extends "adminlte/base.html" %}
{% block content %}

<style>
  .grid-bg {
    background-image: linear-gradient(#e9e9e9 1px, transparent 1px),
                      linear-gradient(90deg, #e9e9e9 1px, transparent 1px);
    background-size: 24px 24px;
    padding: 16px;
    border-radius: 6px;
  }
  .wb-box {
    background: rgba(255,255,255,0.95);
    border: 1px solid #cfcfcf;
    padding: 12px;
  }
  table.wb { width: 100%; border-collapse: collapse; }
  table.wb th, table.wb td { border: 1px solid #111; padding: 6px 8px; font-size: 14px; }
  table.wb th { background: #f4f4f4; font-weight: 700; }
  .dot { width: 10px; height: 10px; border-radius: 999px; display: inline-block; }
  .dot.on { background: #27ae60; }
  .dot.off { background: #bdc3c7; }
  .err { color: #c0392b; font-weight: 700; }
  .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; }
</style>

<div class="grid-bg">
  <div class="wb-box">

    <div class="topbar">
      <div>
        <div style="font-size:12px;color:#666;">Плагины &gt; В работе</div>
        <h3 style="margin:0;">Бот погоды</h3>
      </div>
      <a class="btn btn-primary" href="{% url 'admin_panel:weatherbot_task_add' %}">+ Добавить</a>
    </div>

    <div style="margin-top:10px;">
      <table class="wb">
        <thead>
          <tr>
            <th style="width:70px;">ID</th>
            <th style="width:90px;">Статус</th>
            <th>Страна</th>
            <th>Город</th>
            <th style="width:180px;">Публикуется</th>
            <th style="width:130px;">Ошибок вчера</th>
            <th style="width:130px;">Ошибок сегодня</th>
            <th style="width:90px;">Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.task.id }}</td>
            <td style="text-align:center;">
              {% if r.task.is_enabled %}
                <span class="dot on"></span>
              {% else %}
                <span class="dot off"></span>
              {% endif %}
            </td>
            <td>{{ r.task.city.country.name }}</td>
            <td>{{ r.task.city.name }}</td>
            <td style="text-align:center;">{{ r.targets_count }}</td>
            <td style="text-align:center;" class="{% if r.err_yesterday %}err{% endif %}">{{ r.err_yesterday }}</td>
            <td style="text-align:center;" class="{% if r.err_today %}err{% endif %}">{{ r.err_today }}</td>
            <td style="text-align:center;">
              <a href="{% url 'admin_panel:weatherbot_task_edit' r.task.id %}" title="Редактировать">✏️</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="8" style="text-align:center;">Нет задач</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

{% endblock %}
