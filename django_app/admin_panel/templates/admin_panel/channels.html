{% extends "adminlte/base.html" %}
{% load static %}
{% block content %}
<section class="content">
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h1 class="mb-0">Каналы</h1>
      <span class="col-toggle-btn" title="Управление столбцами">
        <i class="fas fa-cog"></i>
      </span>
    </div>

    <div class="d-flex justify-content-end mb-3">
      <a href="{% url 'admin_panel:channels_add' %}" class="btn btn-add">
        <i class="fas fa-plus"></i> Добавить
      </a>
    </div>


    <div class="table-responsive">
      <table class="table table-bordered table-hover" 
         id="groupsTable" data-sortable data-paginate>

        <thead>
          <tr>
            <th data-type="number">ID</th>
            <th data-type="text">Название</th>
            <!-- <th data-type="number">Telegram ID</th> -->
            <th data-type="text">Страна</th>
            <th data-type="text">Категория</th>
            <th data-type="text">Владелец</th>
            <th data-type="text">Тип</th> 
            <!-- <th data-type="text">Описание</th> -->
            <th data-type="text">Теги</th>
            <th class="no-sort" data-sortable="false">Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for c in channels %}
            <tr>
              <td>{{ c.id }}</td>
              <td>
                <span style="vertical-align:middle;">{{ c.name|default_if_none:"" }}</span>
              </td>
              <!-- <td>{{ c.telegram_id }}</td> -->
              <td>{{ c.country|default_if_none:"" }}</td>
              <td>{{ c.category|default_if_none:"" }}</td>
              <td>{{ c.owner }}</td>
              <td>{{ c.destination_type }}</td>
              <!-- <td>{{ c.description }}</td> -->
              <td class="tags-cell">
                {% if c.tags_list %}
                  {% for t in c.tags_list %}
                    <span class="tag-badge">{{ t }}</span>
                  {% endfor %}
                {% endif %}
              </td>

              <td class="text-center">
                {% if c.link %}<a href="{{ c.link }}" target="_blank" title="Открыть">
                  <img src="{% static 'admin_panel/img/search.png' %}" alt="Открыть" class="icon-16">
                </a>{% endif %}
                <a class="ml-2" href="{% url 'admin_panel:channels_edit' c.id %}" title="Редактировать">
                  <img src="{% static 'admin_panel/img/edit.png' %}" alt="Редактировать" class="icon-16">
                </a>
                <form class="d-inline ml-2" method="post"
                      action="{% url 'admin_panel:channels_delete' c.id %}"
                      onsubmit="return confirm('Удалить канал id={{ c.id }}?')">
                  {% csrf_token %}
                  <button type="submit" class="delete-btn" title="Удалить">
                    <img src="{% static 'admin_panel/img/delete.png' %}" alt="Удалить" class="icon-16">
                  </button>

                </form>
              </td>

            </tr>
          {% empty %}
            <tr><td colspan="8" class="text-center text-muted">Пока нет каналов</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<script type="module">
  import { initSortableTables } from "{% static 'admin_panel/js/sortableTable.js' %}";
  import { initTablePagination } from "{% static 'admin_panel/js/pagination.js' %}";
  import "{% static 'admin_panel/js/colToggles.js' %}";
  import { initValueFilters } from "{% static 'admin_panel/js/valueFilters.js' %}";

  initSortableTables();
  const PAGE_SIZE = 20;
  initTablePagination(PAGE_SIZE);

  initValueFilters({
    tableSelector: "#groupsTable",
    columns: ["Категория"],
    controlsContainerSelector: ".d-flex.justify-content-end.mb-3",
    beforeSelector: "a.btn.btn-add",
    resort: () => { try { initSortableTables(); } catch (_) {} },
    debug: false,
  });
</script>


{% endblock %}
